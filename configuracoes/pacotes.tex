% REFERÊNCIAS------------------------------------------------------------------
\usepackage[%
    alf,
    abnt-emphasize=bf,                      
    abnt-cite-str=lower,
    abnt-cite-style=lower,      
    bibjustif,
    recuo=0cm,
    abnt-url-style=plain,
    abnt-url-package=hyperref,       % Utiliza o pacote url
    abnt-refinfo=yes,           % Utiliza o estilo bibliográfico abnt-refinfo
    abnt-etal-cite=3,
    abnt-etal-list=3,
    abnt-thesis-year=final
]{abntex2cite}                  % Configura as citações bibliográficas conforme a norma ABNT

% PACOTES----------------------------------------------------------------------
\usepackage[utf8]{inputenc}                                 % Codificação do documento
\usepackage[T1]{fontenc}                                    % Seleção de código de fonte
\usepackage{booktabs}                                       % Réguas horizontais em tabelas
\usepackage{color, colortbl}                                % Controle das cores
\usepackage{float}                                          % Necessário para tabelas/figuras em ambiente multi-colunas
\usepackage{graphicx}                                       % Inclusão de gráficos e figuras
\usepackage{icomma}                                         % Uso de vírgulas em expressões matemáticas
\usepackage{indentfirst}                                    % Indenta o primeiro parágrafo de cada seção
\usepackage{microtype}                                      % Melhora a justificação do documento
\usepackage{multirow, array}                                % Permite tabelas com múltiplas linhas e colunas
\usepackage{subeqnarray}                                    % Permite subnumeração de equações
\usepackage{lastpage}                                       % Para encontrar última página do documento
\usepackage{verbatim}                                       % Permite apresentar texto tal como escrito no documento, ainda que sejam comandos Latex
\usepackage{amsfonts, amssymb, amsmath}                     % Fontes e símbolos matemáticos
\usepackage[algoruled, portuguese]{algorithm2e}             % Permite escrever algoritmos em português
% \usepackage[scaled]{helvet}                                % Usa a fonte Helvetica
% \usepackage{times}                                          % Usa a fonte Times
\usepackage{palatino}                                      % Usa a fonte Palatino
% \usepackage{lmodern}                                       % Usa a fonte Latin Modern
\usepackage[bottom]{footmisc}                               % Mantém as notas de rodapé sempre na mesma posição
% \usepackage{ae, aecompl}                                    % Fontes de alta qualidade
\usepackage{latexsym}                                       % Símbolos matemáticos
\usepackage{lscape}                                         % Permite páginas em modo "paisagem"
%\usepackage{picinpar}                                      % Dispor imagens em parágrafos
%\usepackage{scalefnt}                                      % Permite redimensionar tamanho da fonte
%\usepackage{subfig}                                        % Posicionamento de figuras
%\usepackage{upgreek}                                       % Fonte letras gregas
\usepackage{amsthm}
\usepackage{bm}

\usepackage{tabularx}

% ---
% CONTROLE DE LEGENDAS E ESPAÇAMENTOS (TABELAS vs FIGURAS)
% ---
\usepackage{etoolbox} % Pacote para modificar ambientes
\usepackage{caption}  % Pacote para controlar legendas

\DeclareCaptionLabelSeparator{hifen_abnt}{\space\textmd{\textendash}\space}

% 1. Configuração Global (aplica o negrito no rótulo para todos)
\captionsetup{
    labelfont=bf,        % Rótulo em negrito (Ex: Tabela 1, Figura 1)
    labelsep=hifen_abnt,    % Usa o separador definido acima (não negrito)
    textfont=normalfont, % Texto da legenda normal
    skip=10pt            % Espaço padrão (bom para figuras)
}

% 2. Configuração Específica para TABELAS
% Deixa o caption mais perto da tabela
\captionsetup[table]{skip=2pt} 

% Quando entrar no ambiente 'table', redefine o comando \fonte para ser mais "apertado"
\AtBeginEnvironment{table}{%
  \renewcommand{\fonte}[1]{%
    \vspace{-5pt} % Espaço negativo para aproximar a fonte da tabela
    \centering\small{\textbf{Fonte:} #1}%
  }%
}

% 3. Configuração Específica para QUADROS
% Deixa o caption mais perto do quadro
\captionsetup[quadro]{skip=2pt}

% Quando entrar no ambiente 'quadro', redefine o comando \fonte para ser mais "apertado"
\AtBeginEnvironment{quadro}{%
  \renewcommand{\fonte}[1]{%
    \vspace{-5pt} % Espaço negativo para aproximar a fonte do quadro
    \centering\small{\textbf{Fonte:} #1}%
  }%
}
% ---

% Redefine a fonte para uma fonte similar a Arial (fonte Helvetica)
% \renewcommand*\familydefault{\sfdefault}

% Define o estilo "theorem" (negrito, itálico)
\theoremstyle{plain}
\newtheorem{teorema}{Teorema}
\newtheorem{axioma}{Axioma}     
\newtheorem{lema}{Lema}         
\newtheorem{corolario}{Corolário} 

% Define o estilo "definition" (negrito, reto)
\theoremstyle{definition}
\newtheorem{definicao}{Definição} 
\newtheorem{exemplo}{Exemplo}     

% Define o estilo "remark" (itálico, reto)
\theoremstyle{remark}
\newtheorem*{remark}{Nota} 

% Altera o nome padrão "Proof" do ambiente 'proof' para "Demonstração"
\renewcommand{\proofname}{Demonstração}

\definecolor{DarkModeBG}{gray}{0.15}    % Fundo (Cinza bem escuro)
\definecolor{DarkModeText}{gray}{0.95}  % Texto (Cinza bem claro)
\definecolor{DarkModeLink}{rgb}{0.345, 0.651, 1.0} % Link (Azul claro)

% Comando \linkcite{<texto>}{<chave-bib>}
% Cria links separados para o texto e o ano, deixando a pontuação de fora.
% Formato de saída: (<texto>, <ano>)
% \makeatletter
% \newcommand{\linkcite}[3][]{%
%   (%
%   \hyper@natlinkstart{#3}#2\hyper@natlinkend,%
%   ~\hyper@natlinkstart{#3}\citeyear{#3}\hyper@natlinkend%
%   \@ifnotempty{#1}{, p.~#1}
%   )%
% }
% \makeatother

\makeatletter

% 1. Comando principal: verifica o argumento opcional [pagina]
\def\linkcite{\@ifnextchar[{\@linkciteopt}{\@linkcitenormal}}

% 2. Chamado se [pagina] for fornecido: \linkcite[pagina]{texto1}{bibitem1}...
\def\@linkciteopt[#1]#2#3{%
  (%
  \hyper@natlinkstart{#3}#2\hyper@natlinkend,%
  ~\hyper@natlinkstart{#3}\citeyear{#3}\hyper@natlinkend%
  % Inicia o loop, passando a página (#1)
  \@linkciteloop{#1}%
}

% 3. Chamado se [pagina] NÃO for fornecido: \linkcite{texto1}{bibitem1}...
\def\@linkcitenormal#1#2{%
  (%
  \hyper@natlinkstart{#2}#1\hyper@natlinkend,%
  ~\hyper@natlinkstart{#2}\citeyear{#2}\hyper@natlinkend%
  % Inicia o loop, passando uma página vazia ({})
  \@linkciteloop{}%
}

% 4. A MACRO RECURSIVA (LOOP)
%    #1 = a página (pode estar vazia)
\def\@linkciteloop#1{%
  % Verifica se o próximo token é um '{' (início de um novo par)
  \@ifnextchar\bgroup{%
    % Se SIM, chama a macro de processo
    \@linkciteprocess{#1}%
  }{%
    % Se NÃO, chama a macro final
    \@linkciteend{#1}%
  }%
}

% 5. Macro de processo (imprime o próximo par e continua o loop)
%    #1 = a página, #2 = textoN, #3 = bibitemN
\def\@linkciteprocess#1#2#3{%
  ; % Imprime o separador
  ~\hyper@natlinkstart{#3}#2\hyper@natlinkend,%
  ~\hyper@natlinkstart{#3}\citeyear{#3}\hyper@natlinkend%
  % Chama o loop novamente para verificar se há mais
  \@linkciteloop{#1}%
}

% 6. Macro final (termina o comando)
%    #1 = a página
\def\@linkciteend#1{%
  % Imprime a página se ela foi fornecida
  \@ifnotempty{#1}{, #1}%
  % Fecha o parêntese
  )%
}

\makeatother

% ---
% LÓGICA DO MODO ESCURO (DARK MODE)
% ---
\usepackage{xcolor}

% 1. Definição das Cores (Semânticas)
\definecolor{DarkModeBG}{gray}{0.15}     % Fundo Cinza Escuro
\definecolor{DarkModeText}{gray}{0.80}   % Texto Claro
\definecolor{DarkModeLink}{rgb}{0.6, 0.8, 1.0} % Azul Ciano (bom contraste no escuro)
\definecolor{LightModeLink}{RGB}{41,5,195}     % Azul Padrão (bom contraste no claro)

% 2. Aplicação Condicional
\ifbool{darkmode}{
    % --- ATIVAR MODO ESCURO ---
    
    % Define cor de fundo e texto global
    \pagecolor{DarkModeBG}
    \color{DarkModeText}
    
    % Força a cor do texto em TABELAS (tabular/longtable geralmente resetam a cor)
    \AtBeginEnvironment{tabular}{\color{DarkModeText}}
    \AtBeginEnvironment{longtable}{\color{DarkModeText}}
    
    % Força a cor do texto em QUADROS e ALGORITMOS
    \AtBeginEnvironment{quadro}{\color{DarkModeText}}
    \AtBeginEnvironment{algorithm}{\color{DarkModeText}}
    
    % Força a cor do texto nas NOTAS DE RODAPÉ (requer pacote footmisc)
    \renewcommand{\footnotelayout}{\color{DarkModeText}}
    
    % Ajusta a cor da linha de separação do rodapé
    \renewcommand{\footnoterule}{%
        \kern -3pt
        {\color{DarkModeText}\hrule width 2in height 0.4pt}
        \kern 2.6pt
    }
}{
    % --- MODO CLARO (PADRÃO) ---
    \pagecolor{white}
    \color{black}
}
% ---
